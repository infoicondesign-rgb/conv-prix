<!DOCTYPE html>
<html lang="fr-CA">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Conversion & Prix</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b1020">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
  :root{--bg:#0f1115; --card:#171923; --muted:#aab2c8; --text:#eef2ff; --border:#262b3a; --acc:#7c9cff;}
  *{box-sizing:border-box} html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(15,17,21,.95),rgba(15,17,21,.85));backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1000px;margin:0 auto;padding:12px}
  h1{font-size:18px;margin:6px 0}
  table{width:100%;border-collapse:collapse;font-size:15px}
  th,td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left}
  thead th{position:sticky;top:52px;background:var(--card);z-index:9}
  input[type=number]{width:100%;background:#0f1420;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:8px 10px;font-size:15px}
  .num{text-align:right;white-space:nowrap}
  .muted{color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:10px;margin:10px 0}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .field{flex:1 1 180px;display:flex;flex-direction:column;gap:6px}
  .totals{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between}
  .big{font-size:20px;font-weight:800}
  .sticky{position:sticky;bottom:0;background:linear-gradient(0deg,rgba(23,25,35,.98),rgba(23,25,35,.92));border-top:1px solid var(--border)}
</style>
</head>
<body>
<header><div class="wrap"><h1>Tableau de conversion prix</h1></div></header>
<main class="wrap" style="padding-bottom:120px;">
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Longueur (B)</th>
          <th>Largeur (C)</th>
          <th class="num">Pied² (D)</th>
          <th>Type (E)</th>
          <th class="num">Taux (F)</th>
          <th class="num">Taux cost (G)</th>
          <th class="num">Cost (H)</th>
          <th class="num">Prix (I)</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <div class="card">
    <div class="row">
      <div class="field">
        <label>Minutes (B26) — @ 100$/h</label>
        <input id="b26" type="number" inputmode="decimal" step="1" placeholder="0">
      </div>
      <div class="field">
        <label>Heures (B28) — @ 100$/h</label>
        <input id="b28" type="number" inputmode="decimal" step="0.25" placeholder="0">
      </div>
    </div>
    <div class="row">
      <div class="field"><label class="muted">Prix minutes (D26)</label><input id="d26" type="number" readonly></div>
      <div class="field"><label class="muted">Prix heures (D28)</label><input id="d28" type="number" readonly></div>
    </div>
  </div>
</main>

<div class="sticky">
  <div class="wrap">
    <div class="totals">
      <div><span class="muted">Total COST (H26)</span><br><span id="h26" class="big">—</span></div>
      <div><span class="muted">Total PRIX (I26)</span><br><span id="i26" class="big">—</span></div>
    </div>
  </div>
</div>

<script>
(function(){
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function(){ navigator.serviceWorker.register('./sw.js'); });
  }

  const data = {"rows": [{"type": "Pare-pierre 30''", "mode": "area", "largeur_default": 30.0, "taux": 11.0, "taux_cost": 5.25}, {"type": "Pare-pierre 60''", "mode": "area", "largeur_default": 60.0, "taux": 15.0, "taux_cost": 5.06}, {"type": "Murale", "mode": "area", "largeur_default": 0.0, "taux": 6.95, "taux_cost": 1.53}, {"type": "Découpe", "mode": "area", "largeur_default": 0.0, "taux": 5.95, "taux_cost": 0.54}, {"type": "WRAP 3M", "mode": "area", "largeur_default": 0.0, "taux": 40.0, "taux_cost": 13.33}, {"type": "WRAP HEXIS", "mode": "area", "largeur_default": 0.0, "taux": 40.0, "taux_cost": 13.33}, {"type": "WRAP Carbon", "mode": "area", "largeur_default": 0.0, "taux": 80.0, "taux_cost": 30.0}, {"type": "STD / LAM STD", "mode": "area", "largeur_default": 0.0, "taux": 7.65, "taux_cost": 1.0}, {"type": "STD / LAM WRAP", "mode": "area", "largeur_default": 0.0, "taux": 8.5, "taux_cost": 1.51}, {"type": "WRAP / LAM", "mode": "area", "largeur_default": 0.0, "taux": 11.0, "taux_cost": 2.18}, {"type": "PROMO LAM", "mode": "area", "largeur_default": 0.0, "taux": 6.95, "taux_cost": 0.75}, {"type": "PROMO / NONLAM", "mode": "area", "largeur_default": 0.0, "taux": 5.0, "taux_cost": 0.9}, {"type": "Reflec", "mode": "area", "largeur_default": 0.0, "taux": 9.95, "taux_cost": 2.62}, {"type": "Magnétique", "mode": "area", "largeur_default": 0.0, "taux": 20.0, "taux_cost": 1.5}, {"type": "Givré", "mode": "area", "largeur_default": 0.0, "taux": 6.95, "taux_cost": 1.15}, {"type": "Contre-vision", "mode": "area", "largeur_default": 0.0, "taux": 9.95, "taux_cost": 0.71}, {"type": "Découpe Gris CHK", "mode": "area", "largeur_default": 0.0, "taux": 9.95, "taux_cost": 2.57}, {"type": "Bannière", "mode": "area", "largeur_default": 0.0, "taux": 6.95, "taux_cost": 0.17}, {"type": "Aluco", "mode": "area", "largeur_default": 0.0, "taux": 3.25, "taux_cost": 1.88}, {"type": "Coro", "mode": "area", "largeur_default": 0.0, "taux": 2.0, "taux_cost": 0.45}], "config": {"labor_min_rate_price": 100.0, "labor_min_rate_cost": 40.0, "labor_hr_rate_price": 100.0, "labor_hr_rate_cost": 40.0}};
  const fmtCAD = new Intl.NumberFormat('fr-CA', {style:'currency', currency:'CAD'});
  function num(v){ if(v===null||v===undefined||v==='') return 0; v=(''+v).replace(',','.'); var n=parseFloat(v); return isNaN(n)?0:n; }

  function makeRow(r){
    var tr = document.createElement('tr');
    tr.dataset.idx = r;
    var row = data.rows[r];
    tr.innerHTML = ''
      + '<td><input type="number" step="0.1" placeholder="0" class="b"></td>'
      + '<td><input type="number" step="0.1" placeholder="0" class="c"></td>'
      + '<td class="num d">0</td>'
      + '<td>'+row.type+(row.mode==='linear'?' <span class="muted">(linéaire)</span>':'')+'</td>'
      + '<td class="num f">'+row.taux.toFixed(2)+'</td>'
      + '<td class="num g">'+row.taux_cost.toFixed(2)+'</td>'
      + '<td class="num h">0</td>'
      + '<td class="num i">0</td>';
    var b = tr.querySelector('.b');
    var c = tr.querySelector('.c');
    if (row.largeur_default) c.value = row.largeur_default;
    b.addEventListener('input', recalc);
    c.addEventListener('input', recalc);
    return tr;
  }

  function recalc(){
    var sumH=0, sumI=0;
    document.querySelectorAll('#tbody tr').forEach(function(tr){
      var idx = parseInt(tr.dataset.idx);
      var row = data.rows[idx];
      var b = num(tr.querySelector('.b').value);
      var c = num(tr.querySelector('.c').value);
      var d = (row.mode==='linear') ? b : (b*c)/144.0;
      var f = row.taux, g = row.taux_cost;
      var h = d*g;
      var i = (row.mode==='linear') ? (b*f) : (d*f);
      tr.querySelector('.d').textContent = d.toFixed(2);
      tr.querySelector('.h').textContent = fmtCAD.format(h);
      tr.querySelector('.i').textContent = fmtCAD.format(i);
      sumH += h; sumI += i;
    });
    var b26 = num(document.getElementById('b26').value);
    var b28 = num(document.getElementById('b28').value);
    var d26 = (b26/60.0)*100.0;
    var d28 = (b28)*100.0;
    document.getElementById('d26').value = d26.toFixed(2);
    document.getElementById('d28').value = d28.toFixed(2);
    var h26 = sumH + (b26/60.0)*40.0 + b28*40.0;
    var i26 = sumI + d26 + d28;
    document.getElementById('h26').textContent = fmtCAD.format(h26);
    document.getElementById('i26').textContent = fmtCAD.format(i26);
    try{ localStorage.setItem('conv_prix_state', JSON.stringify(serialize())); }catch(e){}
  }

  function serialize(){
    var rows = Array.prototype.slice.call(document.querySelectorAll('#tbody tr')).map(function(tr){
      return { b: tr.querySelector('.b').value, c: tr.querySelector('.c').value };
    });
    return { items: rows, b26: document.getElementById('b26').value, b28: document.getElementById('b28').value };
  }
  function deserialize(d){
    if(!d) return;
    var trs = document.querySelectorAll('#tbody tr');
    (d.items||[]).forEach(function(v,i){
      if(trs[i]){ trs[i].querySelector('.b').value = v.b||''; trs[i].querySelector('.c').value = v.c||''; }
    });
    document.getElementById('b26').value = d.b26||'';
    document.getElementById('b28').value = d.b28||'';
  }

  (function init(){
    var tbody = document.getElementById('tbody');
    data.rows.forEach(function(_,i){ tbody.appendChild(makeRow(i)); });
    var saved = localStorage.getItem('conv_prix_state');
    if(saved) try{ deserialize(JSON.parse(saved)); }catch(e){}
    recalc();
  })();
})();
</script>
</body>
</html>
